name: ZY - INT - CI/CD Pipeline  

on:  
  workflow_dispatch:  
    inputs:  
      environment:  
        description: 'Environment'  
        required: true  
        type: choice  
        options:  
          - 'INT'  
          - 'QA'  
          - 'QAProd'  
          - 'Production'  

jobs:
  Trigger_Builds:
    runs-on: self-hosted
    steps:
      - name: Trigger Workflows  
        uses: actions/github-script@v6  
        with:  
          script: |  
            const repos = [
              'CoreLearner'
              'DemoNotCore'
            ];

            let results = [];

            const environment = process.env.INPUT_ENVIRONMENT;

            for (const repo of repos) {  
              try {
                await github.rest.actions.createWorkflowDispatch({  
                  owner: context.repo.owner,  
                  repo: context.repo.repo,  
                  workflow_id: 'Build_Deploy.yml',  
                  ref: 'main',  
                  inputs: {  
                    repo_name: repo,  
                    environment: environment
                  }  
                });

                console.log(`✅ Triggered workflow for ${repo}`);
                results.push(`${repo}: ✅ Triggered`);
              } catch (error) {  
                console.error(`❌ Failed to trigger ${repo}: ${error.message}`);
                results.push(`${repo}: ❌ Failed`);
              }  
            }  

            core.setOutput("build_results", results.join("\n"));

  Email_Notification:  
    runs-on: self-hosted  
    needs: Trigger_Builds  
    steps:  
      - name: Send Email Notification  
        if: always()  
        shell: bash  
        run: |  
          echo -e "Build Results:\n${{ needs.Trigger_Builds.outputs.build_results }}" > build_status.txt

          #mail -s "INT - CI/CD Build Status" user@example.com < build_status.txt
